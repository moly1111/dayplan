<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/assets/img/11.ico">
    <link rel="shortcut icon" href="/assets/img/11.ico">
    <title>计划表 - XKM</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <!-- 在线上环境使用绝对路径，确保 /xkm 下引用正常 -->
    <link rel="stylesheet" href="/xkm/css/xkm.css">
</head>
<body>
    <!-- 顶部提示条 -->
    <div id="warning-bar" class="warning-bar">
        <div class="warning-content">
            <p>本工具的所有数据仅存储在本地浏览器中，不会同步或上传到云端。<br>
            清理浏览器数据或更换设备将导致数据永久丢失。<br>
            建议定期使用右上角「备份」功能保存数据。<br>
            Data is stored locally only and cannot be recovered if lost. Please back up regularly.</p>
            <div class="warning-buttons">
                <button id="close-warning">关闭</button>
                <button id="dismiss-warning">永久关闭</button>
            </div>
        </div>
    </div>

    <!-- 顶部时间 -->
    <div id="xkm-clock" class="xkm-clock">--:--:--</div>

    <!-- 音乐按钮 -->
    <div class="music-btn-wrapper">
        <button id="music-btn" class="music-btn" title="背景音乐">♪</button>
        <div class="volume-slider-container">
            <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="50" orient="vertical">
        </div>
    </div>

    <!-- 设置按钮 -->
    <button id="settings-btn" class="settings-btn" title="设置">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15.6066 12.5C15.4566 12.7333 15.2833 12.95 15.0916 13.1416L13.1416 15.0916C12.95 15.2833 12.7333 15.4566 12.5 15.6066V17.5C12.5 17.7761 12.2761 18 12 18H8C7.72386 18 7.5 17.7761 7.5 17.5V15.6066C7.26667 15.4566 7.05 15.2833 6.85833 15.0916L4.90833 13.1416C4.71667 12.95 4.54333 12.7333 4.39333 12.5H2.5C2.22386 12.5 2 12.2761 2 12V8C2 7.72386 2.22386 7.5 2.5 7.5H4.39333C4.54333 7.26667 4.71667 7.05 4.90833 6.85833L6.85833 4.90833C7.05 4.71667 7.26667 4.54333 7.5 4.39333V2.5C7.5 2.22386 7.72386 2 8 2H12C12.2761 2 12.5 2.22386 12.5 2.5V4.39333C12.7333 4.54333 12.95 4.71667 13.1416 4.90833L15.0916 6.85833C15.2833 7.05 15.4566 7.26667 15.6066 7.5H17.5C17.7761 7.5 18 7.72386 18 8V12C18 12.2761 17.7761 12.5 17.5 12.5H15.6066Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>

    <!-- 设置面板 -->
    <div id="settings-panel" class="settings-panel hidden">
        <div class="settings-content">
            <h3>设置</h3>
            
            <div class="settings-section">
                <h4>数据</h4>
                <div class="settings-item">
                    <button id="export-btn">备份</button>
                    <button id="import-btn">导入</button>
                    <input type="file" id="import-input" accept=".json" style="display: none;">
                </div>
            </div>

            <div class="settings-section">
                <h4>顶部提醒</h4>
                <div class="settings-item">
                    <label>
                        <input type="checkbox" id="show-warning-checkbox">
                        显示本地存储警告
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h4>完成任务特效</h4>
                <div class="settings-item">
                    <label>
                        <input type="checkbox" id="kill-animation-checkbox">
                        动画开关
                    </label>
                </div>
                <div class="settings-item">
                    <label>
                        <input type="checkbox" id="kill-sound-checkbox">
                        音效开关
                    </label>
                </div>
                <div class="settings-item">
                    <label>
                        <input type="checkbox" id="today-cheer-sound-checkbox">
                        今日全部完成时播放欢呼
                    </label>
                </div>
                <div class="settings-item">
                    <label>
                        <input type="checkbox" id="today-confetti-checkbox">
                        今日全部完成时飘落彩带
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h4>AI</h4>
                <div class="settings-item">
                    <label class="settings-label-stack">
                        <span>DeepSeek API Key</span>
                        <input
                            type="password"
                            id="deepseek-api-key-input"
                            placeholder="sk-..."
                            autocomplete="off"
                        >
                    </label>
                    <p class="settings-note">仅保存在本地浏览器，不会上传到服务器。</p>
                </div>
            </div>

            <div class="settings-section">
                <h4>外观</h4>
                <div class="settings-item">
                    <label>
                        <input type="radio" name="theme" value="light" id="theme-light">
                        Light
                    </label>
                    <label>
                        <input type="radio" name="theme" value="dark" id="theme-dark">
                        Dark
                    </label>
                </div>
            </div>

        </div>
    </div>

    <!-- 主容器 -->
    <div class="container">
        <!-- 左上：日历 -->
        <div class="calendar-section">
            <div id="calendar"></div>
        </div>

        <!-- 右上：计划区 -->
        <div class="tasks-section">
            <div class="tasks-header">
                <div class="tasks-title-wrapper">
            <h2 id="date-title">Today</h2>
                    <span id="streak-days" class="streak-days"></span>
                </div>
                <div class="quick-tasks-wrapper">
                    <button id="quick-tasks-btn" class="quick-tasks-btn">快捷任务</button>
                    <div id="quick-tasks-panel" class="quick-tasks-panel hidden">
                        <div class="quick-tasks-title">常用任务</div>
                        <div id="quick-tasks-list" class="quick-tasks-list"></div>
                        <div class="quick-tasks-editor">
                            <input type="text" id="quick-task-input" placeholder="输入常用任务内容">
                            <button id="quick-task-add" class="quick-task-add-btn">添加</button>
                        </div>
                        <div class="quick-tasks-tip">数据仅存本地，可随时编辑</div>
                    </div>
                </div>
            </div>
            
            <div class="task-input-container">
                <input type="text" id="task-input" placeholder="添加计划，按 Enter 确认">
            </div>

            <div id="total-time-display" class="total-time-display">
                <span class="total-time-label">总用时：</span>
                <span class="total-time-value">0 分钟</span>
            </div>

            <div id="pending-tasks" class="tasks-list"></div>
        </div>
    </div>

    <!-- 下方：已完成计划（折叠） -->
    <div class="completed-section">
        <details>
            <summary>Completed</summary>
            <div id="completed-tasks" class="tasks-list"></div>
        </details>
    </div>

    <!-- 底部声明 -->
    <footer class="footer">
        <p>数据丢失将无法找回，请定期备份并妥善保存。<br>
        Data cannot be recovered if lost. Please back up regularly.</p>
    </footer>

    <!-- 音效（隐藏） -->
    <audio id="kill-sound" preload="auto">
        <source src="../assets/audio/kill.wav" type="audio/wav">
    </audio>
    <audio id="today-cheer-sound" preload="auto">
        <source src="../assets/audio/applause.mp3" type="audio/mpeg">
    </audio>
    <!-- 背景音乐 -->
    <audio id="rain-music" preload="auto" loop>
        <source src="../assets/audio/rain.mp3" type="audio/mpeg">
    </audio>

    <!-- canvas-confetti 浏览器版本 -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <script src="../app/storage.js"></script>
    <script src="../app/calendar.js"></script>
    <script src="../app/settings.js"></script>
    <!-- 先加载 xkm 专用扩展，再加载主逻辑，确保初始渲染就有预估按钮和时间 -->
    <script src="/xkm/js/deepseek-api.js"></script>
    <script src="/xkm/js/xkm-tasks-extension.js"></script>
    <script src="/xkm/js/xkm-quick-tasks.js"></script>
    <script src="../app/main.js"></script>
    <script src="/xkm/js/xkm-main.js"></script>
</body>
</html>

